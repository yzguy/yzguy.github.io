<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Cloud Images in EVE-NG - Yzguy</title><meta name=Description content><meta property="og:url" content="https://yzguy.github.io/posts/cloud-images-in-eve-ng/">
<meta property="og:site_name" content="Yzguy"><meta property="og:title" content="Cloud Images in EVE-NG"><meta property="og:description" content="EVE-NG has documentation on how set up Linux nodes, but provides prepared images. This is helpful, but the latest Ubuntu image is 20.04.2 and we don’t know the origins of these images.
Fortunately, it’s easy to get Ubuntu and Debian cloud images working in EVE-NG
Create Custom Template We will need to create a custom template as we will want some options that aren’t specified in the Linux one
# linux-cloud."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-24T23:30:15-04:00"><meta property="article:modified_time" content="2023-09-24T23:30:15-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cloud Images in EVE-NG"><meta name=twitter:description content="EVE-NG has documentation on how set up Linux nodes, but provides prepared images. This is helpful, but the latest Ubuntu image is 20.04.2 and we don&rsquo;t know the origins of these images.
Fortunately, it&rsquo;s easy to get Ubuntu and Debian cloud images working in EVE-NG
Create Custom Template We will need to create a custom template as we will want some options that aren&rsquo;t specified in the Linux one
# linux-cloud."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yzguy.github.io/posts/cloud-images-in-eve-ng/><link rel=next href=https://yzguy.github.io/posts/picos-v-in-eve-ng/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Cloud Images in EVE-NG","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yzguy.github.io\/posts\/cloud-images-in-eve-ng\/"},"genre":"posts","wordcount":731,"url":"https:\/\/yzguy.github.io\/posts\/cloud-images-in-eve-ng\/","datePublished":"2023-09-24T23:30:15-04:00","dateModified":"2023-09-24T23:30:15-04:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Adam Smith"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Yzguy>Yzguy</a></div><div class=menu><div class=menu-inner><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Yzguy>Yzguy</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Cloud Images in EVE-NG</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/yzguy title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Adam Smith</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=09-24-2023>09-24-2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;731 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#create-custom-template>Create Custom Template</a></li><li><a href=#create-image-folders>Create Image Folder(s)</a></li><li><a href=#download-images>Download Image(s)</a></li><li><a href=#create-cloud-init-iso>Create Cloud-Init ISO</a></li><li><a href=#fix-permissions>Fix Permissions</a></li><li><a href=#deploy-node>Deploy Node</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>EVE-NG has <a href=https://www.eve-ng.net/index.php/documentation/howtos/howto-create-own-linux-host-image/ target=_blank rel="noopener noreffer">documentation</a> on how set up Linux nodes, but provides prepared images.
This is helpful, but the latest Ubuntu image is 20.04.2 and we don&rsquo;t know the origins of these images.</p><p>Fortunately, it&rsquo;s easy to get Ubuntu and Debian cloud images working in EVE-NG</p><h3 id=create-custom-template>Create Custom Template</h3><p>We will need to create a custom template as we will want some options that aren&rsquo;t specified in the <code>Linux</code> one</p><pre tabindex=0><code># linux-cloud.yml
---
type: qemu
description: Linux Cloud Image
name: Linux Cloud Image
cpulimit: 1
icon: Server.png
cpu: 1
ram: 1024
ethernet: 1
console: telnet
shutdown: 1
qemu_arch: x86_64
qemu_version: 2.12.0
qemu_nic: virtio-net-pci
qemu_options: -machine type=pc,accel=kvm -nographic -usbdevice tablet -boot order=cd -cpu host -serial mon:stdio
...
</code></pre><p>After saving this, we can copy it to the AMD & Intel directories where templates are kept</p><pre tabindex=0><code>cp linux-cloud.yml /opt/unetlab/html/templates/amd
cp linux-cloud.yml /opt/unetlab/html/templates/intel
</code></pre><p>Finally, we just need to register the custom template so EVE-NG knows it exists</p><pre tabindex=0><code># /opt/unetlab/html/includes/custom_templates.yml
---
custom_templates:
  - name: linux-cloud
    listname: Linux Cloud
...
</code></pre><h3 id=create-image-folders>Create Image Folder(s)</h3><p>You will need to create a folder on your EVE-NG machine for each cloud image version you want to use.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Image folders must be prefixed with <code>linux-cloud-</code> for EVE-NG to pick them up under the template created in previous step, the text after the hyphen can be whatever you want</div></div></div><pre tabindex=0><code>mkdir /opt/unetlab/addons/qemu/linux-cloud-ubuntu-22.04.3
mkdir /opt/unetlab/addons/qemu/linux-cloud-debian-12
</code></pre><h3 id=download-images>Download Image(s)</h3><p>Both Ubuntu and Debian provide cloud images for download, the location for these can be found below</p><ul><li><a href=https://cloud-images.ubuntu.com/ target=_blank rel="noopener noreffer">Ubuntu Cloud Images</a><ul><li>eg. <code>jammy-server-cloudimg-amd64.img</code></li></ul></li><li><a href=https://cloud.debian.org/images/cloud/ target=_blank rel="noopener noreffer">Debian Cloud Images</a><ul><li>eg. <code>debian-12-genericcloud-amd64.qcow2</code></li></ul></li></ul><p>We will download these to our EVE-NG server into the image folder created above</p><p><strong>Ubuntu:</strong></p><pre tabindex=0><code>cd /opt/unetlab/addons/qemu/linux-cloud-ubuntu-22.04.3
wget https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64.img \
    -O virtioa.qcow2
</code></pre><p><strong>Debian:</strong></p><pre tabindex=0><code>cd /opt/unetlab/addons/qemu/linux-cloud-debian-12
wget https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-amd64.qcow2 \
    -O virtioa.qcow2
</code></pre><h4 id=optional-increase-disk-size>Optional: Increase Disk Size</h4><p>Each cloud image comes with ~2GB of space, this will fill very quickly.</p><pre tabindex=0><code>-&gt; qemu-img info virtioa.qcow2
image: virtioa.qcow2
file format: qcow2
virtual size: 2 GiB (2147483648 bytes)
disk size: 267 MiB
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false
    refcount bits: 16
    corrupt: false
</code></pre><p>We can increase the image size so that more space will be available</p><pre tabindex=0><code>-&gt; qemu-img resize virtioa.qcow2 20G
Image resized.
</code></pre><p>We can verify the new size</p><pre tabindex=0><code>-&gt; qemu-img info virtioa.qcow2
image: virtioa.qcow2
file format: qcow2
virtual size: 20 GiB (21474836480 bytes)
disk size: 267 MiB
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false
    refcount bits: 16
    corrupt: false
</code></pre><p>This will not expand the partition or filesystem, it will just simply increase the size of the disk. Cloud-init will take care of expanding to take up the remaining free space when it boots</p><h3 id=create-cloud-init-iso>Create Cloud-Init ISO</h3><p>Cloud-Init allows you to pass configuration to the operating system that will be executed on first boot.</p><p>In EVE-NG we need to create an <code>iSO</code> file that contains our cloud-init data, this will then be mounted by the VM and then executed when the node first boots</p><p>We will need to create two files: <code>meta-data</code> and <code>user-data</code></p><h5 id=meta-data>meta-data</h5><pre tabindex=0><code>instance-id: node
</code></pre><h5 id=user-data>user-data</h5><pre tabindex=0><code>#cloud-config
password: lab
chpasswd: { expire: False }
ssh_pwauth: True
</code></pre><p>Refer to Cloud-Init&rsquo;s <a href=https://cloudinit.readthedocs.io/en/latest/reference/modules.html target=_blank rel="noopener noreffer">Module Reference</a> and
<a href=https://cloudinit.readthedocs.io/en/latest/reference/examples.html target=_blank rel="noopener noreffer">Examples</a> for more configuration options</p><h4 id=generate-iso>Generate iSO</h4><p>After both files are created, we can create the <code>iSO</code> file that will store them, and will be mounted by the VM</p><pre tabindex=0><code>-&gt; genisoimage -output cdrom.iso -volid cidata -joliet -rock user-data meta-data
I: -input-charset not specified, using utf-8 (detected in locale settings)
Total translation table size: 0
Total rockridge attributes bytes: 331
Total directory bytes: 0
Path table size(bytes): 10
Max brk space used 0
183 extents written (0 MB)
</code></pre><p>After the <code>cdrom.iso</code> is created, we can copy it to the image location</p><pre tabindex=0><code>cp cdrom.iso /opt/unetlab/addons/qemu/linux-cloud-ubuntu-20.04.3
cp cdrom.iso /opt/unetlab/addons/qemu/linux-cloud-debian12
</code></pre><h3 id=fix-permissions>Fix Permissions</h3><p>As with all EVE-NG images, we need to run <code>fixpermissions</code></p><pre tabindex=0><code>/opt/unetlab/wrappers/unl_wrapper -a fixpermissions
</code></pre><h3 id=deploy-node>Deploy Node</h3><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>Warning<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Each node should be connected to the internet in some way before starting them, the easiest being through Cloud0. Without this, they take a long time to boot because Cloud-init is unable to complete</div></div></div><p>Return to your EVE-NG Lab and launch a node, you will find these cloud images under <code>Linux Cloud</code>, then in the <code>Image</code> dropdown you can select the one you want.</p><p>Once that&rsquo;s added to the toplogy, you can start it. Wait for it to come to the login prompt.</p><p>Each image will have a default username, so you&rsquo;ll need to use that along with the password you set in <code>user-data</code>, eg <code>ubuntu / lab</code>.</p><ul><li><strong>Ubuntu</strong>: <code>ubuntu</code></li><li><strong>Debian</strong>: <code>debian</code></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 09-24-2023</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/ data-title="Cloud Images in EVE-NG"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/ data-title="Cloud Images in EVE-NG"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/ data-title="Cloud Images in EVE-NG"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://yzguy.github.io/posts/cloud-images-in-eve-ng/ data-title="Cloud Images in EVE-NG"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/picos-v-in-eve-ng/ class=next rel=next title="PicOS-V in EVE-NG">PicOS-V in EVE-NG<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.125.7">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/yzguy target=_blank>Adam Smith</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>