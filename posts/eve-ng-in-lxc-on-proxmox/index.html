<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>EVE-NG in LXC on Proxmox - Yzguy</title><meta name=Description content><meta property="og:url" content="https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/">
<meta property="og:site_name" content="Yzguy"><meta property="og:title" content="EVE-NG in LXC on Proxmox"><meta property="og:description" content="EVE-NG has multiple deployment methods with mostly references to starting from an iSO or OVF. You can also start from a fresh Ubuntu 22.04 install, then run the installation script to install EVE-NG. You can see these instructions in the Pro or Community Cookbook.
The ability to start from an Ubuntu install and then install EVE-NG on top means we can install it inside an LXC container! However, it’s not as simple due to the fact a LXC container is NOT a virtual machine."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-10T11:14:00-04:00"><meta property="article:modified_time" content="2024-05-10T11:14:00-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="EVE-NG in LXC on Proxmox"><meta name=twitter:description content="EVE-NG has multiple deployment methods with mostly references to starting from an iSO or OVF. You can also start from a fresh Ubuntu 22.04 install, then run the installation script to install EVE-NG. You can see these instructions in the Pro or Community Cookbook.
The ability to start from an Ubuntu install and then install EVE-NG on top means we can install it inside an LXC container! However, it&rsquo;s not as simple due to the fact a LXC container is NOT a virtual machine."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/><link rel=prev href=https://yzguy.github.io/posts/picos-v-in-eve-ng/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"EVE-NG in LXC on Proxmox","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yzguy.github.io\/posts\/eve-ng-in-lxc-on-proxmox\/"},"genre":"posts","wordcount":684,"url":"https:\/\/yzguy.github.io\/posts\/eve-ng-in-lxc-on-proxmox\/","datePublished":"2024-05-10T11:14:00-04:00","dateModified":"2024-05-10T11:14:00-04:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Adam Smith"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Yzguy>Yzguy</a></div><div class=menu><div class=menu-inner><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Yzguy>Yzguy</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">EVE-NG in LXC on Proxmox</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/yzguy title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Adam Smith</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=05-10-2024>05-10-2024</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;684 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#create-lxc-container>Create LXC Container</a></li><li><a href=#upgrade-ubuntu>Upgrade Ubuntu</a></li><li><a href=#install-eve-ng>Install EVE-NG</a></li><li><a href=#troubleshooting>Troubleshooting</a></li><li><a href=#caveats>Caveats</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>EVE-NG has multiple deployment methods with mostly references to starting from an iSO or OVF. You can also start from a fresh Ubuntu 22.04 install, then run the installation script to install EVE-NG. You can see these instructions in the <a href=https://www.eve-ng.net/index.php/documentation/professional-cookbook/ target=_blank rel="noopener noreffer">Pro</a> or <a href=https://www.eve-ng.net/index.php/documentation/community-cookbook/ target=_blank rel="noopener noreffer">Community</a> Cookbook.</p><p>The ability to start from an Ubuntu install and then install EVE-NG on top means we can install it inside an LXC container! However, it&rsquo;s not as simple due to the fact a LXC container is NOT a virtual machine. We will need to tweak the configuration to allow nesting and to allow cgroups in the LXC container.</p><p>Additionally, we will be deploying our EVE-NG installation on top of Proxmox VE 8.x so that we can use the same system for other purposes if necessary. These instructions will work for both EVE-NG Pro and EVE-NG Community.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Ubuntu 22.04 LXC Template</li></ul><h3 id=create-lxc-container>Create LXC Container</h3><ol><li>Click Create CT button Proxmox</li><li>Generate<ol><li>Enter a hostname</li><li>Uncheck <code>Unprivileged Container</code></li><li>Enter/Confirm password</li><li>(Optional) Enter an SSH Public Key</li></ol></li><li>Template<ol><li>Select <code>ubuntu-22.04-standard_22.04-1_amd64.tar.gz</code> template</li></ol></li><li>Disks<ol><li>Set desired disk size</li></ol></li><li>CPU<ol><li>Set desired cores</li></ol></li><li>Memory<ol><li>Set desired memory</li><li>Set desired swap</li></ol></li><li>Network<ol><li>(Optional) Set VLAN Tag</li><li>Uncheck Firewall</li><li>Set IPv4 to Static or DHCP</li><li>Set IPv6 to Static, DHCP, SLAAC</li></ol></li><li>DNS<ol><li>Set DNS domain as desired (or leave to use host settings)</li><li>Set DNS servers as desired (or leave to use host settings)</li></ol></li><li>Confirm<ol><li>Do <strong>NOT</strong> check &ldquo;Start after created&rdquo;</li><li>Click Finish</li></ol></li></ol><p>You will now have an Ubuntu LXC, but there are a few more modifications to do before we can start it and install EVE-NG</p><ol><li>Select your LXC from the navigation</li><li>(Optional) Add additional network interfaces (eth1, eth2, etc.)<ul><li>For additional interfaces, leave IPv4 and IPv6 set to Static, but do not enter an IP</li></ul></li><li>Under Options > Features<ol><li>Check Nesting</li><li>Check FUSE</li></ol></li></ol><p>This will allow the the LXC to launch additional containers, this is necessary for EVE-NG to function. We will need to do an additional step on the CLI</p><ol><li><p>SSH to the Proxmox Node</p></li><li><p>Open the LXC&rsquo;s configuration file</p><ol><li><code>/etc/pve/lxc/&lt;ID>.conf</code>, eg <code>/etc/pve/lxc/111.conf</code></li></ol></li><li><p>At the end of the file add the following</p><pre tabindex=0><code>lxc.cgroup2.devices.allow: a
lxc.mount.entry: /dev/net dev/net none bind,create=dir
lxc.apparmor.profile: unconfined
lxc.cap.drop:
</code></pre><ul><li>Allows LXC access to all devices</li><li>Mounts the hosts /dev/net into the LXC</li><li>Sets the apparmor profile to unconfined (open)</li><li>Gives LXC all capabilities</li></ul><p><a href=https://linuxcontainers.org/lxc/manpages/man5/lxc.container.conf.5.html target=_blank rel="noopener noreffer">Reference</a></p></li><li><p>Save and quit</p></li></ol><h3 id=upgrade-ubuntu>Upgrade Ubuntu</h3><ol><li>Start your LXC</li><li>From the console or SSH<ol><li>Run <code>apt-get update && apt-get upgrade -y</code></li><li>Install <code>gnupg2</code> dependency via <code>apt-get install gnupg2 -y</code></li></ol></li><li>Reboot</li></ol><h3 id=install-eve-ng>Install EVE-NG</h3><p>Finally, we have all the bits in place to install EVE-NG. We will need to use the installation script as we are installing on top of an existing Ubuntu installation.</p><ul><li><p>EVE-NG Pro</p><pre tabindex=0><code>wget -O - https://www.eve-ng.net/jammy/install-eve-pro.sh | bash -i
</code></pre></li><li><p>EVE-NG Community</p><pre tabindex=0><code>wget -O - https://www.eve-ng.net/jammy/install-eve.sh | bash -i
</code></pre></li></ul><p>After installation completes, you will need to reboot. Once then system is booted again, you will be starting from the same point as if you started from the iSO or OVF.</p><p>You will want to install the remaining dependencies</p><pre tabindex=0><code>apt-get update &amp;&amp; apt-get install eve-ng-dockers -y
</code></pre><h3 id=troubleshooting>Troubleshooting</h3><h4 id=consoles-do-not-work>Consoles do not work</h4><p><code>guacd</code> will listen on <code>::1</code>, but is expected to be listening on <code>127.0.0.1</code>, you can confirm this is happening by running below</p><pre tabindex=0><code>root@eve:~# ss -lntp | grep guacd
LISTEN 0      5                   [::1]:4822          [::]:*    users:((&#34;guacd&#34;,pid=1196,fd=4))
</code></pre><p>To fix this follow the process below</p><ol><li><p>Create <code>/etc/guacamole/guacd.conf</code> with the following contents</p><pre tabindex=0><code>[server]
bind_host = 127.0.0.1
bind_port = 4822
</code></pre></li><li><p>Add the following properties to <code>/etc/guacamole/guacamole.properties</code></p><pre tabindex=0><code>guacd-hostname: 127.0.0.1
guacd-port: 4822
</code></pre></li><li><p>Restart <code>guacd</code> via <code>systemctl restart guacd</code></p></li><li><p>Confirm it is now listening on <code>127.0.0.1</code></p><pre tabindex=0><code>root@eve:/etc/guacamole# ss -lntp | grep guacd
LISTEN 0      5               127.0.0.1:4822       0.0.0.0:*    users:((&#34;guacd&#34;,pid=29290,fd=4))
</code></pre></li></ol><h3 id=caveats>Caveats</h3><p>Without a custom kernel for Proxmox, the linux bridges in LXC will be unable to forward several protocols (STP/RSTP/MSTP, LLDP, LACP, etc.) as a linux bridge is compliant with 802.1D and must filter frames for these protocols (they use IEEE 802.1D MAC Bridge Filtered MAC Group Addresses)</p><p><a href=https://interestingtraffic.nl/2017/11/21/an-oddly-specific-post-about-group_fwd_mask/ target=_blank rel="noopener noreffer">Reference 1</a>, <a href=https://blog.ipspace.net/2020/12/linux-bridge-lldp.html target=_blank rel="noopener noreffer">Reference 2</a></p><p>The EVE-NG installation in a VM/OVF already contains a modified kernel that allows these protocols, but is likely not suitable to be used as a proxmox kernel.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 05-10-2024</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/ data-title="EVE-NG in LXC on Proxmox"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/ data-title="EVE-NG in LXC on Proxmox"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/ data-title="EVE-NG in LXC on Proxmox"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://yzguy.github.io/posts/eve-ng-in-lxc-on-proxmox/ data-title="EVE-NG in LXC on Proxmox"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/picos-v-in-eve-ng/ class=prev rel=prev title="PicOS-V in EVE-NG"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>PicOS-V in EVE-NG</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.125.7">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/yzguy target=_blank>Adam Smith</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>